#+TITLE: Microservicio Login - API
#+AUTHOR: fran
#+LANGUAGE: es
#+STARTUP: content indent showeverything
#+DESCRIPTION: API del microservicio Login
#+PROPERTY: header-args:verb :wrap src ob-verb-response
#+OPTIONS: results:t
* API :verb:
template http://localhost:4567
Accept: application/json
** Usuarios
*** Alta
Crea un nuevo usuario en la bd.
#+begin_src verb
  post /registrar
  Content-Type: application/json; charset=utf-8
  
  {
  "usuario": "TestUsuarioValido",
  "email": "unMailValido@gmail.com",
  "nombre": "UsuarioValido",
  "contra": "12345678"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 23:05:13 GMT
Content-Length: 27

{
  "mensaje": "Alta exitosa"
}
#+end_src

*** Login
:properties:
:Verb-Store: res-login
:end:
#+begin_src verb 
  post /login
  Content-Type: application/json; charset=utf-8

  {
  "usuario": "fran",
  "contra": "123"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:53:36 GMT
Content-Length: 579

{
  "permisos": [
    {
      "id": 1,
      "nombre": "USUARIO_ALTA"
    },
    {
      "id": 2,
      "nombre": "USUARIO_BAJA"
    },
    {
      "id": 3,
      "nombre": "USUARIO_LISTAR"
    },
    {
      "id": 4,
      "nombre": "USUARIO_MODIFICAR"
    }
  ],
  "rol": "ADMIN",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU2NTg0MTYsInBlcm1pc29zIjoiW3tcImlkXCI6IDEsIFwibm9tYnJlXCI6IFwiVVNVQVJJT19BTFRBXCJ9LHtcImlkXCI6IDIsIFwibm9tYnJlXCI6IFwiVVNVQVJJT19CQUpBXCJ9LHtcImlkXCI6IDMsIFwibm9tYnJlXCI6IFwiVVNVQVJJT19MSVNUQVJcIn0se1wiaWRcIjogNCwgXCJub21icmVcIjogXCJVU1VBUklPX01PRElGSUNBUlwifV0iLCJyb2wiOiJBRE1JTiIsInVzdWFyaW8iOiJmcmFuIn0.xqDiobOEh_Y37p5GJDzoKZ_Htpf5rE-G5l6PHzwWB1s"
}
#+end_src

*** Alta Rol
#+begin_src verb
  post /p/usuario/8/rol
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "rol_id": 1
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 22:23:08 GMT
Content-Length: 36

{
  "mensaje": "Modificaci贸n exitosa"
}
#+end_src
*** Baja Rol
#+begin_src verb
  delete /p/usuario/6/rol
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "rol_id": 2
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 00:46:03 GMT
Content-Length: 27

{
  "mensaje": "Baja exitosa"
}
#+end_src

*** Buscar
#+begin_src verb 
  get /p/usuario/1
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:44:06 GMT
Content-Length: 361

{
  "datos": {
    "id": 1,
    "usuario": "fran",
    "contra": "$2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2",
    "email": "",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "ADMIN",
    "permisos": [
      {
        "id": 1,
        "nombre": "USUARIO_ALTA"
      },
      {
        "id": 2,
        "nombre": "USUARIO_BAJA"
      },
      {
        "id": 3,
        "nombre": "USUARIO_LISTAR"
      },
      {
        "id": 4,
        "nombre": "USUARIO_MODIFICAR"
      }
    ]
  },
  "mensaje": "Peticion exitosa"
}
#+end_src

*** Paginado
#+begin_src verb
  get /p/usuario
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:53:40 GMT
Content-Length: 1001

{
  "datos": [
    {
      "id": 1,
      "usuario": "fran",
      "contra": "$2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2",
      "email": "",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": "ADMIN",
      "permisos": [
        {
          "id": 1,
          "nombre": "USUARIO_ALTA"
        },
        {
          "id": 2,
          "nombre": "USUARIO_BAJA"
        },
        {
          "id": 3,
          "nombre": "USUARIO_LISTAR"
        },
        {
          "id": 4,
          "nombre": "USUARIO_MODIFICAR"
        }
      ]
    },
    {
      "id": 2,
      "usuario": "fran2",
      "contra": "$2a$10$3Y0ACtiagET0hasOs2zs3OXFj18gUGZX247OeNQS6DW0M..IcVbKO",
      "email": "",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": "EMPLEADO",
      "permisos": [
        {
          "id": 3,
          "nombre": "USUARIO_LISTAR"
        }
      ]
    },
    {
      "id": 3,
      "usuario": "fran3",
      "contra": "$2a$10$idqTko6.OM4hxae7Omn/3OZqCNSUtsnMWWQ2w7G1GaOcqVVdJVc8u",
      "email": "",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": "USUARIO",
      "permisos": [
        {
          "id": 0,
          "nombre": ""
        }
      ]
    },
    {
      "id": 5,
      "usuario": "testeowachin",
      "contra": "$2a$15$ymTgqjsNh4xzK5dgjPMHeuiqT6bfltjmt7N90sKv.rndls2JVRUz.",
      "email": "",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": null,
      "permisos": [
        {
          "id": 0,
          "nombre": ""
        }
      ]
    }
  ],
  "mensaje": "Peticion exitosa"
}
#+end_src

Paginado args
#+begin_src verb 
  get /p/usuario?diferencia=0&limite=2
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}  
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 02:17:36 GMT
Content-Length: 518

{
  "datos": [
    {
      "id": 1,
      "usuario": "fran",
      "contra": "$2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2",
      "email": "fran1@gmail.com",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": "ADMIN",
      "permisos": "USUARIO_ALTA, USUARIO_BAJA, USUARIO_LISTAR, USUARIO_MODIFICAR"
    },
    {
      "id": 2,
      "usuario": "fran2",
      "contra": "$2a$10$3Y0ACtiagET0hasOs2zs3OXFj18gUGZX247OeNQS6DW0M..IcVbKO",
      "email": "fran2@gmail.com",
      "nombre": null,
      "telefono": null,
      "direccion": null,
      "rol": "EMPLEADO",
      "permisos": "USUARIO_LISTAR"
    }
  ],
  "mensaje": "Peticion exitosa"
}
#+end_src

*** Modificar
#+begin_src verb 
  put /p/usuario/5
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "usuario": "testeowachin",
  "email": "testeomanito@test.com",
  "nombre": "eaeaea",
  "contra": "123"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 400 Bad Request
Content-Type: application/json
Date: Tue, 19 Aug 2025 23:07:47 GMT
Content-Length: 36

{
  "mensaje": "Formulario incorrecto"
}
#+end_src

*** Baja
#+begin_src verb
  delete /p/usuario/4
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 23:05:42 GMT
Content-Length: 27

{
  "mensaje": "Baja exitosa"
}
#+end_src

** Permisos
*** Alta
#+begin_src verb
  post /p/permiso
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "nombre": "PERMISO_DESDE_API"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:18:56 GMT
Content-Length: 53

{
  "datos": {
    "id": 5
  },
  "mensaje": "Modificaci贸n exitosa"
}
#+end_src

** Rol
*** Alta
#+begin_src verb
  post /p/rol
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "nombre": "ROL_DESDE_API"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:17:34 GMT
Content-Length: 53

{
  "datos": {
    "id": 4
  },
  "mensaje": "Modificaci贸n exitosa"
}
#+end_src
*** Buscar
#+begin_src verb
  get /p/rol
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:42:32 GMT
Content-Length: 431

{
  "datos": [
    {
      "id": 1,
      "rol": "ADMIN",
      "permisos": [
        {
          "id": 1,
          "nombre": "USUARIO_ALTA"
        },
        {
          "id": 2,
          "nombre": "USUARIO_BAJA"
        },
        {
          "id": 3,
          "nombre": "USUARIO_LISTAR"
        },
        {
          "id": 4,
          "nombre": "USUARIO_MODIFICAR"
        }
      ]
    },
    {
      "id": 2,
      "rol": "EMPLEADO",
      "permisos": [
        {
          "id": 3,
          "nombre": "USUARIO_LISTAR"
        }
      ]
    },
    {
      "id": 3,
      "rol": "USUARIO",
      "permisos": [
        {
          "id": 0,
          "nombre": ""
        }
      ]
    },
    {
      "id": 4,
      "rol": "ROL_DESDE_API",
      "permisos": [
        {
          "id": 5,
          "nombre": "PERMISO_DESDE_API"
        }
      ]
    }
  ],
  "mensaje": "Peticion exitosa"
}
#+end_src

*** Alta permiso
#+begin_src verb
  post /p/rol/4
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "permiso_id": 5
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Wed, 20 Aug 2025 01:19:25 GMT
Content-Length: 36

{
  "mensaje": "Modificaci贸n exitosa"
}
#+end_src
*** Baja Permiso
#+begin_src verb
  delete /p/rol/1
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer {{(verb-json-get (oref (verb-stored-response "res-login") body) "token")}}

  {
  "permiso_id": 5
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Tue, 19 Aug 2025 00:21:45 GMT
Content-Length: 27

{
  "mensaje": "Baja exitosa"
}
#+end_src
