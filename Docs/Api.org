#+TITLE: Microservicio Login - API
#+AUTHOR: fran
#+LANGUAGE: es
#+STARTUP: content indent showeverything
#+DESCRIPTION: API del microservicio Login
#+PROPERTY: header-args:verb :wrap src ob-verb-response
#+OPTIONS: results:t
* API :verb:
template http://localhost:4567
Accept: application/json

** Registrar
Crea un nuevo usuario en la bd.
#+begin_src verb
  post /registrar
  Content-Type: application/json; charset=utf-8

  {
  "usuario": "testeowachin",
  "email": "testeomanito@test.com",
  "nombre": "eaeaea",
  "contra": "easdasdaeaea"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sun, 17 Aug 2025 22:59:13 GMT
Content-Length: 31

{
  "mensaje": "Registro exitoso"
}
#+end_src

** Login
#+begin_src verb
  post /login
  Content-Type: application/json; charset=utf-8

  {
  "usuario": "fran",
  "contra": "123"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sun, 17 Aug 2025 23:37:53 GMT
Content-Length: 349

{
  "permisos": "USUARIO_ALTA, USUARIO_BAJA, USUARIO_LISTAR, USUARIO_MODIFICAR",
  "rol": "ADMIN",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU0Nzc0NzMsInBlcm1pc29zIjoiVVNVQVJJT19BTFRBLCBVU1VBUklPX0JBSkEsIFVTVUFSSU9fTElTVEFSLCBVU1VBUklPX01PRElGSUNBUiIsInJvbCI6IkFETUlOIiwidXN1YXJpbyI6ImZyYW4ifQ.xLpYq-3liaKlxIrPUrVRTgKrpkZcF6ak4wL3O-oRCAU"
}
#+end_src

** Usuarios
Default paginado
#+begin_src verb 
  get /p/usuario
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU0NzQ2NTAsInBlcm1pc29zIjoiVVNVQVJJT19BTFRBLCBVU1VBUklPX0JBSkEsIFVTVUFSSU9fTElTVEFSLCBVU1VBUklPX01PRElGSUNBUiIsInJvbCI6IkFETUlOIiwidXN1YXJpbyI6ImZyYW4ifQ.FkLxJeWsIC4xeogYB7CYgJ7bcz-skGSEM5kwMQtR6Xg
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sun, 17 Aug 2025 23:05:57 GMT
Content-Length: 899

[
  {
    "id": 1,
    "usuario": "fran",
    "contra": "$2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2",
    "email": "fran1@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "ADMIN",
    "permisos": "USUARIO_ALTA, USUARIO_BAJA, USUARIO_LISTAR, USUARIO_MODIFICAR"
  },
  {
    "id": 2,
    "usuario": "fran2",
    "contra": "$2a$10$3Y0ACtiagET0hasOs2zs3OXFj18gUGZX247OeNQS6DW0M..IcVbKO",
    "email": "fran2@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "EMPLEADO",
    "permisos": "USUARIO_LISTAR"
  },
  {
    "id": 3,
    "usuario": "fran3",
    "contra": "$2a$10$idqTko6.OM4hxae7Omn/3OZqCNSUtsnMWWQ2w7G1GaOcqVVdJVc8u",
    "email": "fran3@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "USUARIO",
    "permisos": null
  },
  {
    "id": 4,
    "usuario": "testeowachin",
    "contra": "$2a$15$IfsIVOVNil5uJKBufgxHj.DKDYdA5p3HcX07QdJULk.jcxy8CReUC",
    "email": "testeomanito@test.com",
    "nombre": "eaeaea",
    "telefono": null,
    "direccion": null,
    "rol": null,
    "permisos": null
  }
]
#+end_src

Paginado args
#+begin_src verb 
  get /p/usuario?diferencia=0&limite=10
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU0NzU1NDEsInBlcm1pc29zIjoiVVNVQVJJT19BTFRBLCBVU1VBUklPX0JBSkEsIFVTVUFSSU9fTElTVEFSLCBVU1VBUklPX01PRElGSUNBUiIsInJvbCI6IkFETUlOIiwidXN1YXJpbyI6ImZyYW4ifQ.ZtFxbDhLpSCOoqTGjw6RLKmwM0n2F74dpey8FLoItzY
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sun, 17 Aug 2025 23:42:41 GMT
Content-Length: 683

[
  {
    "id": 1,
    "usuario": "fran",
    "contra": "$2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2",
    "email": "fran1@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "ADMIN",
    "permisos": "USUARIO_ALTA, USUARIO_BAJA, USUARIO_LISTAR, USUARIO_MODIFICAR"
  },
  {
    "id": 2,
    "usuario": "fran2",
    "contra": "$2a$10$3Y0ACtiagET0hasOs2zs3OXFj18gUGZX247OeNQS6DW0M..IcVbKO",
    "email": "fran2@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "EMPLEADO",
    "permisos": "USUARIO_LISTAR"
  },
  {
    "id": 3,
    "usuario": "fran3",
    "contra": "$2a$10$idqTko6.OM4hxae7Omn/3OZqCNSUtsnMWWQ2w7G1GaOcqVVdJVc8u",
    "email": "fran3@gmail.com",
    "nombre": null,
    "telefono": null,
    "direccion": null,
    "rol": "USUARIO",
    "permisos": null
  }
]
#+end_src

** Modificar
#+begin_src verb 
  post /p/usuario/4
  Content-Type: application/json; charset=utf-8
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU0NzU1NDEsInBlcm1pc29zIjoiVVNVQVJJT19BTFRBLCBVU1VBUklPX0JBSkEsIFVTVUFSSU9fTElTVEFSLCBVU1VBUklPX01PRElGSUNBUiIsInJvbCI6IkFETUlOIiwidXN1YXJpbyI6ImZyYW4ifQ.ZtFxbDhLpSCOoqTGjw6RLKmwM0n2F74dpey8FLoItzY
  

  {
  "usuario": "testeowachin",
  "email": "testeomanito@test.com",
  "nombre": "eaeaea",
  "contra": "easdasdaeaea"
  }
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sun, 17 Aug 2025 23:05:50 GMT
Content-Length: 36

{
  "mensaje": "Actualizacion exitosa"
}
#+end_src

** Eliminar

#+begin_src verb
  delete /p/usuario/4
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTU0Nzc0NzMsInBlcm1pc29zIjoiVVNVQVJJT19BTFRBLCBVU1VBUklPX0JBSkEsIFVTVUFSSU9fTElTVEFSLCBVU1VBUklPX01PRElGSUNBUiIsInJvbCI6IkFETUlOIiwidXN1YXJpbyI6ImZyYW4ifQ.xLpYq-3liaKlxIrPUrVRTgKrpkZcF6ak4wL3O-oRCAU
#+end_src

#+RESULTS:
#+begin_src ob-verb-response
HTTP/1.1 500 Internal Server Error
Content-Type: application/json
Date: Sun, 17 Aug 2025 23:39:07 GMT
Content-Length: 42

{
  "mensaje": "Error interno en el sistema"
}
#+end_src

* SQL
#+PROPERTY: header-args:sql :engine mysql :dbhost localhost :dbuser root :dbpassword root :database ServicioLoginDB
#+name: my-query
#+begin_src sql
  SELECT * FROM Usuario;
#+end_src

#+RESULTS: my-query
| id | creado              | ult_mod             | estado | usuario  | email             | contra                                                       | nombre      | telefono | direccion |
|----+---------------------+---------------------+--------+----------+-------------------+--------------------------------------------------------------+-------------+----------+-----------|
|  1 | 2025-08-13 03:07:32 | 2025-08-13 03:07:32 | ACTIVO | fran     | fran1@gmail.com   | $2a$10$GwuLXIm2pFBq5KOUc27VjOqiNAv.sQ3rj8YgwooVcF7vxGgeviEr2 | NULL        | NULL     | NULL      |
|  2 | 2025-08-13 03:07:32 | 2025-08-13 03:07:32 | ACTIVO | fran2    | fran2@gmail.com   | $2a$10$3Y0ACtiagET0hasOs2zs3OXFj18gUGZX247OeNQS6DW0M..IcVbKO | NULL        | NULL     | NULL      |
|  3 | 2025-08-13 03:07:32 | 2025-08-13 03:07:32 | ACTIVO | fran3    | fran3@gmail.com   | $2a$10$idqTko6.OM4hxae7Omn/3OZqCNSUtsnMWWQ2w7G1GaOcqVVdJVc8u | NULL        | NULL     | NULL      |
|  4 | 2025-08-13 03:38:29 | 2025-08-13 03:38:29 | ACTIVO | usuario5 | usuario5@test.com | $2a$15$a2.HbI9hOGPCviTNAR3YXOf8KQn8m0AxusYDfffCgqKGYctLXViYG | usuariotest | NULL     | NULL      |
